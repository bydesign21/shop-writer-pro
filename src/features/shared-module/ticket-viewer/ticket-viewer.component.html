<!-- LET SOOOOO GOOOO -->

<div class="overflow-y-scroll h-[55vh] p-4 bg-gray-50">
  <!-- Card Section -->
  <nz-card
    class="mb-4 text-sm shadow-lg border border-gray-300 p-4 bg-white rounded-md"
    [nzTitle]="updatedTicket.plan"
    [nzExtra]="'$' + updatedTicket.totalUSD"
  >
    <p class="text-gray-700">Summary: {{ updatedTicket.description }}</p>
    <div class="admin-tags text-gray-500" *ngIf="rules === userRole.ADMIN">
      <p>
        Customer:
        <nz-tag
          class="cursor-pointer ml-2 rounded-3xl bg-gray-200 mt-2 px-2 py-1 rounded"
          (click)="handleUserProfileClick($event.target, 'user')"
          [nzColor]="'grey'"
        >
          {{ updatedTicket.userId }}
        </nz-tag>
      </p>
      <p>
        Assigned To:
        <nz-tag
          class="cursor-pointer ml-2 bg-gray-200 rounded-3xl px-2 mt-2 py-1 rounded"
          (click)="handleUserProfileClick($event.target, 'employee')"
          [nzColor]="'black'"
        >
          {{ updatedTicket.assignedTo }}
        </nz-tag>
      </p>
    </div>
  </nz-card>

  <!-- Collapse Section -->
  <nz-collapse class="review-form text-sm" nzGhost>
    <nz-collapse-panel
      *ngFor="let panel of panels"
      [nzHeader]="panel.name"
      [nzActive]="panel.active"
      [nzDisabled]="panel.disabled"
    >
      <!-- Panel for Vehicle Details -->
      <div
        class="relative bg-white p-4 rounded-md shadow-lg border border-gray-300 mb-4"
        *ngIf="panel.id === 2"
      >
        <!-- Edit Button -->
        <span
          nz-icon
          *ngIf="updatedTicket.status === ticketStatusEnum.PENDING"
          nzType="edit"
          (click)="handleEditButtonTrigger($event)"
          class="edit-button relative bottom-2 right-2 text-xl text-white bg-gray-500 p-2 rounded-full cursor-pointer"
        ></span>
        <!-- Vehicle Details Card -->
        <nz-card [nzTitle]="'Vehicle Details'" class="flex flex-col">
          <!-- Insurance Form Item -->
          <nz-form-item>
            <nz-form-label>Insurance</nz-form-label>
            <input
              nz-input
              required="true"
              [disabled]="!editVehicleInfo"
              [placeholder]="updatedTicket.insurance || 'N/A'"
              [(ngModel)]="updatedTicket.insurance"
              [nzAutocomplete]="auto"
            />
            <nz-autocomplete
              [nzDataSource]="insuranceList"
              nzBackfill
              #auto
            ></nz-autocomplete>
          </nz-form-item>

          <!-- Vin Form Item -->
          <nz-form-item>
            <nz-form-label>Vin</nz-form-label>
            <input
              nz-input
              required="true"
              [disabled]="!editVehicleInfo"
              [placeholder]="updatedTicket.vin"
              [(ngModel)]="updatedTicket.vin"
            />
          </nz-form-item>

          <!-- Year Form Item -->
          <nz-form-item>
            <nz-form-label>Year</nz-form-label>
            <input
              nz-input
              required="true"
              [disabled]="!editVehicleInfo"
              [placeholder]="updatedTicket.year"
              [(ngModel)]="updatedTicket.year"
            />
          </nz-form-item>

          <!-- Make Form Item -->
          <nz-form-item>
            <nz-form-label>Make</nz-form-label>
            <input
              nz-input
              required="true"
              [disabled]="!editVehicleInfo"
              [placeholder]="updatedTicket.make"
              [(ngModel)]="updatedTicket.make"
            />
          </nz-form-item>

          <!-- Model Form Item -->
          <nz-form-item>
            <nz-form-label>Model</nz-form-label>
            <input
              nz-input
              required="true"
              [disabled]="!editVehicleInfo"
              [placeholder]="updatedTicket.model"
              [(ngModel)]="updatedTicket.model"
            />
          </nz-form-item>

          <!-- Mileage Form Item -->
          <nz-form-item>
            <nz-form-label>Mileage</nz-form-label>
            <input
              nz-input
              required="true"
              [disabled]="!editVehicleInfo"
              [placeholder]="updatedTicket.mileage | number: '1.0-0'"
              [ngModel]="updatedTicket.mileage | number: '1.0-0'"
              (ngModelChange)="
                updatedTicket.mileage = $event.replaceAll(',', '')
              "
            />
          </nz-form-item>

          <!-- Save Changes Button -->
          <nz-button-group *ngIf="editVehicleInfo">
            <button
              nz-button
              (click)="handleEditVehicleInfo($event)"
              type="submit"
            >
              Save Changes
            </button>
          </nz-button-group>
        </nz-card>
      </div>

      <!-- Panel for Vehicle Damage -->
      <div
        class="relative bg-white p-4 rounded-md shadow-lg border border-gray-300 mb-4"
        *ngIf="panel.id === 3"
      >
        <!-- Edit Button -->
        <span
          nz-icon
          *ngIf="updatedTicket.status === ticketStatusEnum.PENDING"
          nzType="edit"
          (click)="handleEditButtonTrigger($event)"
          class="edit-button relative bottom-2 right-2 text-xl text-white bg-gray-500 p-2 rounded-full cursor-pointer"
        ></span>
        <!-- Vehicle Damage Card -->
        <nz-card [nzTitle]="'Vehicle Damage'" class="flex flex-col">
          <!-- Damage Description Form Item -->
          <nz-form-item>
            <nz-form-label>Damage Description</nz-form-label>
            <textarea
              nz-input
              rows="10"
              required="true"
              [disabled]="!editVehicleInfo"
              [(ngModel)]="updatedTicket.description"
            ></textarea>
          </nz-form-item>
          <!-- Save Changes Button -->
          <nz-button-group *ngIf="editVehicleInfo">
            <button
              nz-button
              (click)="handleEditVehicleInfo($event)"
              type="button"
            >
              Save Changes
            </button>
          </nz-button-group>
        </nz-card>
      </div>

      <!-- Panel for Uploaded Images -->
      <div class="relative" *ngIf="panel.id === 4">
        <!-- Uploaded Images Card -->
        <nz-card [nzTitle]="'Uploaded Images'">
          <div>
            <nz-image-group
              class="[&>.cdk-drag]:flex [&>.cdk-drag]:align-center [&>.cdk-drag]:justify-center"
            >
              <img
                nz-image
                class="review-form__img"
                *ngFor="let img of updatedTicket.images"
                [nzSrc]="img"
              />
            </nz-image-group>
          </div>
        </nz-card>
      </div>

      <!-- Panel for Upload -->
      <div class="relative" *ngIf="panel.id === 5">
        <!-- Upload Card -->
        <nz-card [nzTitle]="panel.name" [nzExtra]="ticketStatusRef">
          <nz-upload
            ngDefaultControl
            nzType="drag"
            [nzCustomRequest]="customReq"
            [nzMultiple]="true"
            (nzChange)="handleUploadChange($event)"
            [nzListType]="'picture'"
            [nzFileList]="selectedFiles"
            [nzRemove]="handleFileRemove"
            [nzDownload]="handleFileDownload"
            [nzShowUploadList]="{
              showPreviewIcon: true,
              showRemoveIcon: true,
              showDownloadIcon: true
            }"
          >
            <p class="ant-upload-drag-icon">
              <span nz-icon nzType="inbox"></span>
            </p>
            <p class="ant-upload-text">
              Click or drag file to this area to upload
            </p>
            <p class="ant-upload-hint">
              Support for a single or bulk upload. Strictly prohibit from
              uploading company data or other band files
            </p>
          </nz-upload>
        </nz-card>
      </div>

      <!-- Other panels remain the same, apply similar styling as above for consistency -->
    </nz-collapse-panel>
  </nz-collapse>

  <!-- Ticket Status Dropdown Template -->
  <ng-container>
    <ng-template #ticketStatusRef>
      <nz-select
        class="w-[10rem] bg-white border border-gray-300 rounded shadow-lg"
        (ngModelChange)="handleTicketStatusChange($event)"
        [(ngModel)]="updatedTicket.status"
        [nzPlaceHolder]="'Ticket Status'"
        [nzOptions]="ticketStatusOptions"
        [nzDropdownClassName]="'ticket-status-dropdown'"
      ></nz-select>
    </ng-template>
  </ng-container>
</div>
